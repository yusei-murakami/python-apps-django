{% extends 'tracker/base.html' %}
{% block content %}
  <h2 class="text-lg font-semibold mb-4">新規記録を追加</h2>

  <div class="bg-white p-4 rounded-2xl shadow-sm">
    <form method="post" class="space-y-4">
      {% csrf_token %}
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <div>
          <label class="block text-sm text-gray-600">日付</label>
          {{ form.date }}
        </div>
        <div>
          <label class="block text-sm text-gray-600">体温 (℃)</label>
          {{ form.temperature }}
        </div>

        <div>
          <label class="block text-sm text-gray-600">体重 (kg)</label>
          {{ form.weight }}
        </div>
        <div>
          <label class="block text-sm text-gray-600">血圧 上 / 下</label>
          <div class="flex gap-2">
            {{ form.bp_sys }}
            {{ form.bp_dia }}
          </div>
        </div>

        <div>
          <label class="block text-sm text-gray-600">睡眠時間 (h)</label>
          {{ form.sleep_hours }}
        </div>
        <div>
          <label class="block text-sm text-gray-600">消費カロリー (kcal)</label>
          {{ form.burned_calories }}
        </div>

        <div>
          <label class="block text-sm text-gray-600">歩数</label>
          {{ form.steps }}
        </div>
      </div>

      <hr class="my-2">

      <div>
        <h3 class="font-medium mb-2">食事（食品名 + 数量(g) + kcal/100g）</h3>
        <div id="foods">
          <div class="grid grid-cols-3 gap-2 mb-2">
            <input name="food_name_1" placeholder="食品名" class="border p-2 rounded" />
            <input name="food_qty_1" placeholder="数量(g)" class="border p-2 rounded" inputmode="decimal" />
            <input name="food_cal_1" placeholder="kcal/100g" class="border p-2 rounded" inputmode="decimal" />
          </div>
        </div>
        <div class="flex gap-2">
          <button type="button" id="addFood" class="px-3 py-1 rounded bg-gray-100">食品を追加</button>
          <div id="foodTotal" class="text-sm text-gray-500 self-center">合計: 0 kcal</div>
        </div>
      </div>

      <div class="flex justify-end">
        <button type="submit" class="px-4 py-2 rounded bg-blue-600 text-white">保存</button>
      </div>
    </form>
  </div>

<script>
let idx = 2;
document.getElementById('addFood').addEventListener('click', ()=>{
  const container = document.getElementById('foods');
  const div = document.createElement('div');
  div.className = 'grid grid-cols-3 gap-2 mb-2';
  div.innerHTML = `<input name="food_name_${idx}" placeholder="食品名" class="border p-2 rounded" />`+
                  `<input name="food_qty_${idx}" placeholder="数量(g)" class="border p-2 rounded" inputmode="decimal" />`+
                  `<input name="food_cal_${idx}" placeholder="kcal/100g" class="border p-2 rounded" inputmode="decimal" />`;
  container.appendChild(div);
  idx += 1;
});
</script>
{% endblock %}
